<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="theme-color" content="#2c2c54" />
  
  <!-- SEO 메타 태그 -->
  <title>깃하이라이트 - GitHub 인기 프로젝트 한글 요약 모음</title>
  <meta name="description" content="GitHub에서 인기 있는 오픈소스 프로젝트를 한글로 요약하고 코드 예제와 함께 제공하는 서비스입니다. 매일 업데이트되는 개발 트렌드를 확인하세요." />
  <meta name="keywords" content="GitHub, 깃허브, 오픈소스, 코드, 프로그래밍, 개발자, 트렌드, 요약, 한글, 북마크" />
  <meta name="author" content="깃하이라이트" />
  <meta name="robots" content="index, follow" />
  
  <!-- 표준 링크 태그 -->
  <link rel="canonical" href="https://githi.com/" />
  <link rel="alternate" hreflang="ko" href="https://githi.com/" />
  
  <!-- 파비콘 설정 -->
  <link rel="shortcut icon" href="/favicon.ico" />
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <link rel="apple-touch-icon" href="/static/icons/192x192.png" />
  <link rel="icon" type="image/png" sizes="192x192" href="/static/icons/192x192.png" />
  <link rel="icon" type="image/png" sizes="512x512" href="/static/icons/592x592.png" />
  
  <!-- Open Graph 메타 태그 (페이스북, 카카오톡 등) -->
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://githi.com/" />
  <meta property="og:title" content="깃하이라이트 - GitHub 인기 프로젝트 한글 요약 모음" />
  <meta property="og:description" content="GitHub에서 인기 있는 오픈소스 프로젝트를 한글로 요약하고 코드 예제와 함께 제공하는 서비스입니다." />
  <meta property="og:image" content="https://githi.com/static/icons/592x592.png" />
  <meta property="og:site_name" content="깃하이라이트" />
  <meta property="og:locale" content="ko_KR" />
  
  <!-- Twitter Card 메타 태그 -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="깃하이라이트 - GitHub 인기 프로젝트 한글 요약 모음" />
  <meta name="twitter:description" content="GitHub에서 인기 있는 오픈소스 프로젝트를 한글로 요약하고 코드 예제와 함께 제공하는 서비스입니다." />
  <meta name="twitter:image" content="https://githi.com/static/icons/592x592.png" />
  
  <!-- PWA 관련 메타 태그 -->
  <link rel="manifest" href="/static/manifest.json" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  <meta name="apple-mobile-web-app-title" content="깃하이라이트" />
  
  <link rel="stylesheet" href="/static/style.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" />
  
  <!-- 기존 head 부분의 내용 -->
  <script>
    // DOM이 로드된 후 요소 참조 설정
    document.addEventListener('DOMContentLoaded', () => {
      // 설치 버튼 참조
      let deferredPrompt;
      const installButton = document.getElementById('install-button');
      
      // 초기 상태에서는 설치 버튼을 숨김
      if (installButton) {
        installButton.style.display = 'none';
      }
      
      // 앱이 이미 설치되었는지 확인
      if (window.matchMedia('(display-mode: standalone)').matches || 
          window.navigator.standalone === true) {
        // 이미 설치된 앱으로 실행 중일 때
        console.log('앱이 이미 설치되어 있습니다.');
        if (installButton) {
          installButton.style.display = 'none';
        }
      } else {
        console.log('브라우저에서 실행 중입니다. 앱 설치 가능합니다.');
      }
      
      // 설치 버튼 클릭 이벤트
      if (installButton) {
        installButton.addEventListener('click', async () => {
          if (deferredPrompt) {
            // 설치 프롬프트 표시
            deferredPrompt.prompt();
            // 사용자 응답 대기
            const { outcome } = await deferredPrompt.userChoice;
            console.log(`사용자 선택: ${outcome}`);
            // deferredPrompt 초기화
            deferredPrompt = null;
          } else {
            console.log('설치 프롬프트가 없습니다.');
            alert('앱 설치를 시작할 수 없습니다. 브라우저가 설치를 지원하지 않거나 이미 설치되었을 수 있습니다.');
          }
        });
      }
      
      // 설치 가능 이벤트 감지
      window.addEventListener('beforeinstallprompt', (e) => {
        // 브라우저 기본 설치 프롬프트 방지
        e.preventDefault();
        // 이벤트 저장
        deferredPrompt = e;
        // 설치 버튼 표시
        if (installButton) {
          installButton.style.display = 'flex';
        }
      });
      
      // 앱 설치 완료 이벤트 감지
      window.addEventListener('appinstalled', (e) => {
        console.log('앱이 성공적으로 설치되었습니다!');
        // 설치 버튼 숨기기
        if (installButton) {
          installButton.style.display = 'none';
        }
        // deferredPrompt 초기화
        deferredPrompt = null;
      });
    });
  </script>
</head>
<body>
  <header>
    <div class="header-container">
      <div class="logo-section">
        <h1><a href="/" class="logo-link"> 깃하이라이트</a></h1>
        <p>전 세계 개발자들이 스타를 누른 GitHub 명작,<br>아이디어는 이제 당신의 차례입니다 - {{ today }}</p>
      </div>
      
      <button class="toggle-menu" id="menuToggle">
        <i class="fas fa-bars"></i>
      </button>

      <nav class="main-nav" id="mainNav">
        <ul>
          <li><a href="/" title="홈"><i class="fas fa-home"></i> 홈</a></li>
          <li><a href="/about" title="사이트 소개"><i class="fas fa-info-circle"></i> 소개</a></li>
          {% if current_user.is_authenticated %}
            <li><a href="/bookmarks" title="내 북마크"><i class="fas fa-bookmark"></i> 북마크</a></li>
            <li><a href="/logout" title="로그아웃"><i class="fas fa-sign-out-alt"></i> 로그아웃</a></li>
          {% else %}
            <li><a href="/login" title="로그인"><i class="fas fa-sign-in-alt"></i> 로그인</a></li>
            <li><a href="/register" class="register-btn" title="회원가입"><i class="fas fa-user-plus"></i> 회원가입</a></li>
          {% endif %}
          <li class="mobile-only" id="install-app-menu-item" style="display: none;">
            <button id="install-button" class="menu-button">
              <i class="fas fa-download"></i> 앱 설치
            </button>
          </li>
        </ul>
      </nav>
    </div>
  </header>
  <main>
    <div class="container">
      <div class="repositories-container">
        <div id="repositories-list">
          {% for repo in repos[:10] %}
          <section class="card">
            <h2><a href="{{ repo.link }}" target="_blank">{{ repo.name }}</a></h2>
            <div class="stars-container">
              <span class="stars"><i class="fas fa-star"></i> {{ repo.stars }}</span>
            </div>
            <div class="summary-section">
              <p><strong class="summary-label">요약:</strong> {{ repo.summary }}</p>
              <p><strong class="feature-label">기능:</strong> {{ repo.feature }}</p>
            </div>
            <pre><code>{{ repo.code }}</code></pre>
            <div class="card-actions">
              {% if current_user.is_authenticated %}
                {% if repo.bookmarked %}
                  <button class="bookmark-btn remove-bookmark" data-id="{{ repo.bookmark_id }}">
                    <i class="fas fa-bookmark"></i> 북마크 삭제
                  </button>
                {% else %}
                  <button class="bookmark-btn add-bookmark" data-name="{{ repo.name }}">
                    <i class="far fa-bookmark"></i> 북마크 추가
                  </button>
                {% endif %}
                
                <button class="comment-toggle" data-repo-id="{{ repo.id }}">
                  <i class="fas fa-comments"></i> 댓글 <span class="comment-count">{{ repo.comment_count }}</span>
                </button>
              {% else %}
                <button class="bookmark-btn need-login">
                  <i class="far fa-bookmark"></i> 북마크
                </button>
                <button class="comment-toggle need-login">
                  <i class="fas fa-comments"></i> 댓글
                </button>
              {% endif %}
            </div>
            
            <!-- 접이식 댓글 섹션 -->
            {% if current_user.is_authenticated %}
            <div class="comments-section" style="display: none;" id="comments-{{ repo.id }}">
              <div class="comments-list">
                <!-- 댓글은 JavaScript로 동적 로드됩니다 -->
                <div class="loading-comments">댓글을 불러오는 중...</div>
              </div>
              
              <div class="comment-form-container">
                <form class="comment-form" data-repo-id="{{ repo.id }}">
                  <textarea placeholder="의견이나 질문을 남겨보세요..." required></textarea>
                  <button type="submit">댓글 작성</button>
                </form>
              </div>
            </div>
            {% endif %}
          </section>
          {% endfor %}
        </div>
        
        <!-- 더보기 버튼 -->
        <div id="load-more-container" class="text-center my-4" {% if repos|length <= 10 %}style="display:none"{% endif %}>
          <button id="load-more-btn" class="btn btn-primary">더보기</button>
          <div id="loading-indicator" class="mt-2" style="display:none">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
  <footer>
    <p>&copy; 깃하이라이트 2025 | <a href="https://github.com" target="_blank">GitHub</a>에서 발견된 보석들</p>
  </footer>
  
  <!-- 위로 가기 버튼 -->
  <button id="back-to-top" title="맨 위로 이동" style="display: none;"><i class="fas fa-arrow-up"></i></button>
  
  <!-- 구조화된 데이터 (JSON-LD) -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebSite",
    "name": "깃하이라이트",
    "url": "https://githi.com",
    "description": "GitHub에서 인기 있는 오픈소스 프로젝트를 한글로 요약하고 코드 예제와 함께 제공하는 서비스입니다.",
    "potentialAction": {
      "@type": "SearchAction",
      "target": "https://githi.com/search?q={search_term_string}",
      "query-input": "required name=search_term_string"
    },
    "sameAs": [
      "https://github.com/githi"
    ]
  }
  </script>
  
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Organization",
    "name": "깃하이라이트",
    "url": "https://githi.com",
    "logo": "https://githi.com/static/icons/592x592.png",
    "contactPoint": {
      "@type": "ContactPoint",
      "contactType": "customer service",
      "email": "admin@githi.com"
    }
  }
  </script>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // 모바일 기기 감지
      function isMobileDevice() {
        return (window.innerWidth <= 768) || 
               /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
      }
      
      // 앱 설치 관련 변수
      let deferredPrompt;
      const installButton = document.getElementById('install-button');
      const installMenuItem = document.getElementById('install-app-menu-item');
      
      // 모바일에서만 메뉴 항목 표시
      if (installMenuItem) {
        if (isMobileDevice()) {
          installMenuItem.style.display = 'block';
        } else {
          installMenuItem.style.display = 'none';
        }
      }
      
      // 화면 크기 변경 감지
      window.addEventListener('resize', function() {
        if (installMenuItem) {
          if (isMobileDevice()) {
            installMenuItem.style.display = 'block';
          } else {
            installMenuItem.style.display = 'none';
          }
        }
      });
      
      // 앱 설치 프롬프트 캐치
      window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
        
        // 설치 버튼 활성화 (이미 display:block은 CSS로 처리됨)
        if (installButton) {
          // 이벤트 리스너 추가
          installButton.addEventListener('click', async () => {
            if (!deferredPrompt) {
              alert('설치 프롬프트를 사용할 수 없습니다. 이미 설치되었거나 브라우저가 지원하지 않을 수 있습니다.');
              return;
            }
            
            // 설치 프롬프트 표시
            deferredPrompt.prompt();
            const { outcome } = await deferredPrompt.userChoice;
            console.log(`설치 결과: ${outcome}`);
            
            // 프롬프트 재사용 불가
            deferredPrompt = null;
            
            // 설치 완료 또는 취소 후 메뉴 항목 숨기기
            if (installMenuItem) {
              installMenuItem.style.display = 'none';
            }
          });
        }
      });
      
      // 앱이 이미 설치된 경우 메뉴 항목 숨기기
      window.addEventListener('appinstalled', () => {
        console.log('앱이 성공적으로 설치되었습니다!');
        deferredPrompt = null;
        if (installMenuItem) {
          installMenuItem.style.display = 'none';
        }
      });
      
      // 앱 모드에서 실행 중인 경우 메뉴 항목 숨기기
      if (window.matchMedia('(display-mode: standalone)').matches || 
          window.navigator.standalone === true) {
        console.log('앱 모드로 실행 중입니다!');
        if (installMenuItem) {
          installMenuItem.style.display = 'none';
        }
      }
      
      // 햄버거 메뉴 토글
      const menuToggle = document.querySelector('.toggle-menu');
      const mainNav = document.getElementById('mainNav');
      
      if (menuToggle && mainNav) {
        menuToggle.addEventListener('click', function() {
          mainNav.classList.toggle('active');
        });
      }
      
      // 스크롤 이벤트 처리
      const header = document.querySelector('header');
      
      window.addEventListener('scroll', function() {
        if (window.scrollY > 50) {
          header.classList.add('scrolled');
        } else {
          header.classList.remove('scrolled');
        }
        
        // 위로 가기 버튼 표시/숨김
        const backToTopButton = document.getElementById("back-to-top");
        if (window.scrollY > 300) {
          backToTopButton.style.display = "block";
        } else {
          backToTopButton.style.display = "none";
        }
      });
      
      // 다크모드/라이트모드 감지 및 처리
      if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark-mode');
      }
      
      // 로그인 필요 북마크 버튼 클릭 이벤트
      document.querySelectorAll('.need-login').forEach(btn => {
        btn.addEventListener('click', function() {
          alert('북마크 기능을 사용하려면 로그인이 필요합니다.');
          window.location.href = '/login';
        });
      });
      
      // 북마크 추가 버튼 클릭 이벤트
      document.querySelectorAll('.add-bookmark').forEach(btn => {
        btn.addEventListener('click', function() {
          const repoName = this.dataset.name;
          const button = this;
          
          fetch('/add_bookmark', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({ repo_name: repoName })
          })
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              // 버튼 상태 변경
              button.innerHTML = '<i class="fas fa-bookmark"></i> 북마크 삭제';
              button.classList.remove('add-bookmark');
              button.classList.add('remove-bookmark');
              button.dataset.id = data.bookmark_id;
              
              // 새 이벤트 리스너 추가 필요
              setupRemoveListener(button);
              
              alert('북마크에 추가되었습니다.');
            } else {
              alert(data.message || '오류가 발생했습니다.');
            }
          })
          .catch(error => {
            console.error('북마크 추가 오류:', error);
            alert('북마크 추가 중 오류가 발생했습니다.');
          });
        });
      });
      
      // 북마크 삭제 버튼 클릭 이벤트
      function setupRemoveListener(button) {
        button.addEventListener('click', function() {
          const bookmarkId = this.dataset.id;
          const button = this;
          
          fetch(`/bookmark/${bookmarkId}`, {
            method: 'DELETE'
          })
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              // 버튼 상태 변경
              button.innerHTML = '<i class="far fa-bookmark"></i> 북마크 추가';
              button.classList.remove('remove-bookmark');
              button.classList.add('add-bookmark');
              button.dataset.name = button.closest('.card').querySelector('h2 a').textContent;
              delete button.dataset.id;
              
              alert('북마크가 삭제되었습니다.');
            } else {
              alert(data.message || '오류가 발생했습니다.');
            }
          })
          .catch(error => {
            alert('북마크 삭제 중 오류가 발생했습니다.');
          });
        });
      }
      
      document.querySelectorAll('.remove-bookmark').forEach(setupRemoveListener);
      
      // 댓글 토글 기능
      document.querySelectorAll('.comment-toggle').forEach(button => {
        if (!button.classList.contains('need-login')) {
          const repoId = button.dataset.repoId;
          const commentsSection = document.getElementById(`comments-${repoId}`);
          
          button.addEventListener('click', function() {
            if (commentsSection.style.display === 'none') {
              // 댓글 섹션 열기
              commentsSection.style.display = 'block';
              loadComments(repoId);
            } else {
              // 댓글 섹션 닫기
              commentsSection.style.display = 'none';
            }
          });
        }
      });
      
      // 댓글 로딩 함수
      function loadComments(repoId) {
        const commentsSection = document.getElementById(`comments-${repoId}`);
        const commentsList = commentsSection.querySelector('.comments-list');
        
        // 이미 로딩된 경우 스킵
        if (!commentsList.querySelector('.loading-comments')) {
          return;
        }
        
        fetch(`/comments/${repoId}`)
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              updateCommentCount(repoId, data.comments.length);
              
              commentsList.innerHTML = '';
              
              if (data.comments.length === 0) {
                commentsList.innerHTML = '<div class="no-comments">아직 댓글이 없습니다. 첫 댓글을 작성해보세요!</div>';
              } else {
                data.comments.forEach(comment => {
                  const commentElement = createCommentElement(comment);
                  commentsList.appendChild(commentElement);
                });
              }
            } else {
              commentsList.innerHTML = '<div class="comment-error">댓글을 불러오는 중 오류가 발생했습니다.</div>';
              console.error('댓글 로딩 오류:', data.message);
            }
          })
          .catch(error => {
            commentsList.innerHTML = '<div class="comment-error">댓글을 불러오는 중 오류가 발생했습니다.</div>';
            console.error('댓글 로딩 중 오류:', error);
          });
      }
      
      // 댓글 추가 이벤트
      document.querySelectorAll('.comment-form').forEach(form => {
        form.addEventListener('submit', function(e) {
          e.preventDefault();
          
          const repoId = this.dataset.repoId;
          const textarea = this.querySelector('textarea');
          const content = textarea.value.trim();
          
          if (content.length < 2) {
            alert('댓글은 최소 2자 이상이어야 합니다.');
            return;
          }
          
          fetch('/comments', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              repo_id: repoId,
              content: content
            })
          })
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              // 성공적으로 댓글 추가
              const commentsList = document.getElementById(`comments-${repoId}`).querySelector('.comments-list');
              
              // 첫 댓글인 경우 처리
              if (commentsList.querySelector('.no-comments')) {
                commentsList.innerHTML = '';
              }
              
              // 새 댓글 추가
              const commentElement = createCommentElement(data.comment);
              commentsList.appendChild(commentElement);
              
              // 댓글 수 업데이트
              const currentCount = parseInt(document.querySelector(`.comment-toggle[data-repo-id="${repoId}"] .comment-count`).textContent);
              updateCommentCount(repoId, currentCount + 1);
              
              // 입력 필드 초기화
              textarea.value = '';
            } else {
              alert('댓글 작성 중 오류가 발생했습니다: ' + data.message);
            }
          })
          .catch(error => {
            console.error('댓글 작성 중 오류:', error);
            alert('댓글 작성 중 오류가 발생했습니다.');
          });
        });
      });
      
      // 댓글 요소 생성 함수
      function createCommentElement(comment) {
        const commentDiv = document.createElement('div');
        commentDiv.className = 'comment-item';
        commentDiv.dataset.id = comment.id;
        
        // 현재 사용자 ID (서버에서 렌더링 시 값이 채워짐)
        const currentUserId = parseInt("{{ current_user.id if current_user.is_authenticated else 0 }}");
        
        const isMyComment = comment.user_id === currentUserId;
        
        commentDiv.innerHTML = `
          <div class="comment-header">
            <span class="comment-author">${comment.username}</span>
            <span class="comment-date">${comment.created_at}</span>
            ${isMyComment ? '<button class="delete-comment"><i class="fas fa-trash-alt"></i></button>' : ''}
          </div>
          <div class="comment-content">${escapeHtml(comment.content)}</div>
        `;
        
        // 내 댓글이면 삭제 기능 추가
        if (isMyComment) {
          const deleteBtn = commentDiv.querySelector('.delete-comment');
          deleteBtn.addEventListener('click', function() {
            if (confirm('정말 이 댓글을 삭제하시겠습니까?')) {
              deleteComment(comment.id, comment.repo_id);
            }
          });
        }
        
        return commentDiv;
      }
      
      // 댓글 삭제 함수
      function deleteComment(commentId, repoId) {
        fetch(`/comments/${commentId}`, {
          method: 'DELETE'
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            // 댓글 요소 삭제
            const commentElement = document.querySelector(`.comment-item[data-id="${commentId}"]`);
            commentElement.remove();
            
            // 댓글 수 업데이트
            const commentsList = document.getElementById(`comments-${repoId}`).querySelector('.comments-list');
            const comments = commentsList.querySelectorAll('.comment-item');
            
            updateCommentCount(repoId, comments.length);
            
            // 댓글이 없는 경우 메시지 표시
            if (comments.length === 0) {
              commentsList.innerHTML = '<div class="no-comments">아직 댓글이 없습니다. 첫 댓글을 작성해보세요!</div>';
            }
          } else {
            alert('댓글 삭제 중 오류가 발생했습니다: ' + data.message);
          }
        })
        .catch(error => {
          alert('댓글 삭제 중 오류가 발생했습니다.');
        });
      }
      
      // 댓글 수 업데이트 함수
      function updateCommentCount(repoId, count) {
        const countElement = document.querySelector(`.comment-toggle[data-repo-id="${repoId}"] .comment-count`);
        countElement.textContent = count;
      }
      
      // HTML 이스케이프 함수
      function escapeHtml(unsafe) {
        return unsafe
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;")
          .replace(/"/g, "&quot;")
          .replace(/'/g, "&#039;");
      }
      
      // 위로 가기 버튼 클릭 이벤트
      const backToTopButton = document.getElementById("back-to-top");
      backToTopButton.addEventListener("click", function() {
        window.scrollTo({
          top: 0,
          behavior: "smooth"
        });
      });
      
      // 페이지네이션 관련 변수
      let currentPage = 2; // 첫 10개는 서버에서 직접 렌더링했으므로 2부터 시작
      const itemsPerPage = 10;
      let isLoading = false;
      let hasMoreItems = "{{ 'true' if repos|length > 10 else 'false' }}" === "true";
      
      // 더보기 버튼 클릭 이벤트
      const loadMoreBtn = document.getElementById('load-more-btn');
      if (loadMoreBtn) {
        loadMoreBtn.addEventListener('click', function() {
          if (isLoading || !hasMoreItems) return;
          
          loadMoreRepositories();
        });
      }
      
      // 추가 저장소 로드 함수
      function loadMoreRepositories() {
        if (isLoading) return;
        
        isLoading = true;
        document.getElementById('loading-indicator').style.display = 'block';
        
        fetch(`/api/repositories?page=${currentPage}&limit=${itemsPerPage}`)
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              const repositoriesList = document.getElementById('repositories-list');
              
              // 새 저장소 추가
              data.repositories.forEach(repo => {
                const repoElement = createRepositoryElement(repo);
                repositoriesList.appendChild(repoElement);
              });
              
              // 더 불러올 항목이 있는지 확인
              hasMoreItems = data.hasMore;
              if (!hasMoreItems) {
                document.getElementById('load-more-container').style.display = 'none';
              }
              
              currentPage++;
            } else {
              console.error('저장소 로드 실패:', data.message);
            }
            
            isLoading = false;
            document.getElementById('loading-indicator').style.display = 'none';
          })
          .catch(error => {
            console.error('API 호출 중 오류 발생:', error);
            isLoading = false;
            document.getElementById('loading-indicator').style.display = 'none';
          });
      }
      
      // 저장소 요소 생성 함수
      function createRepositoryElement(repo) {
        const repoCard = document.createElement('section');
        repoCard.className = 'card';
        
        // HTML 템플릿 생성
        repoCard.innerHTML = `
          <h2><a href="${repo.link || '#'}" target="_blank">${repo.name}</a></h2>
          <div class="stars-container">
            <span class="stars"><i class="fas fa-star"></i> ${repo.stars}</span>
          </div>
          <div class="summary-section">
            <p><strong class="summary-label">요약:</strong> ${repo.summary || '요약 정보 없음'}</p>
            <p><strong class="feature-label">기능:</strong> ${repo.feature || '기능 정보 없음'}</p>
          </div>
          <pre><code>${repo.code || '코드 예제 없음'}</code></pre>
          <div class="card-actions">
            <button class="bookmark-btn add-bookmark" data-name="${repo.name}">
              <i class="far fa-bookmark"></i> 북마크 추가
            </button>
            <button class="comment-toggle" data-repo-id="${repo.id}">
              <i class="fas fa-comments"></i> 댓글 <span class="comment-count">0</span>
            </button>
          </div>
          <div class="comments-section" style="display: none;" id="comments-${repo.id}">
            <div class="comments-list">
              <div class="loading-comments">댓글을 불러오는 중...</div>
            </div>
            <div class="comment-form-container">
              <form class="comment-form" data-repo-id="${repo.id}">
                <textarea placeholder="의견이나 질문을 남겨보세요..." required></textarea>
                <button type="submit">댓글 작성</button>
              </form>
            </div>
          </div>
        `;
        
        // 이벤트 리스너 추가
        const commentToggleBtn = repoCard.querySelector('.comment-toggle');
        if (commentToggleBtn) {
          commentToggleBtn.addEventListener('click', function() {
            const repoId = this.getAttribute('data-repo-id');
            toggleComments(repoId);
          });
        }
        
        const bookmarkBtn = repoCard.querySelector('.add-bookmark');
        if (bookmarkBtn) {
          bookmarkBtn.addEventListener('click', function() {
            const repoName = this.getAttribute('data-name');
            addBookmark(repoName, this);
          });
        }
        
        const commentForm = repoCard.querySelector('.comment-form');
        if (commentForm) {
          commentForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const repoId = this.getAttribute('data-repo-id');
            const textarea = this.querySelector('textarea');
            const content = textarea.value.trim();
            
            if (content) {
              submitComment(repoId, content, this);
            }
          });
        }
        
        return repoCard;
      }
    });
  </script>

  <!-- PWA 서비스 워커 등록 -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/static/service-worker.js')
          .then(registration => {
            console.log('서비스 워커가 성공적으로 등록되었습니다:', registration.scope);
          })
          .catch(error => {
            console.error('서비스 워커 등록 실패:', error);
          });
      });
    }
  </script>
</body>
</html>
